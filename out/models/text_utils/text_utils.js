import*as t from"../../third_party/codemirror.next/codemirror.next.js";import*as e from"../../core/platform/platform.js";var n=Object.freeze({__proto__:null,createCssTokenizer:function(){return async function(e,n){const r=await t.cssStreamParser(),i=new t.StringStream(e,4,2),s=r.startState();let o=i.pos;for(;!i.eol();){i.start=o;let t=r.token(i,s);"error"===t&&"maybeprop"===s.state&&(t="property");n(i.current(),t),o=i.pos}}}});class r{lineNumber;lineContent;columnNumber;constructor(t,e,n){this.lineNumber=t,this.lineContent=e,this.columnNumber=n}}var i=Object.freeze({__proto__:null,ContentProvider:class{},SearchMatch:r,contentAsDataURL:function(t,e,n,r,i=!0){return null==t||i&&t.length>1048576?null:"data:"+e+(r?";charset="+r:"")+(n?";base64":"")+","+t}});class s{lineEndings;offsetInternal;lineNumberInternal;columnNumberInternal;constructor(t){this.lineEndings=t,this.offsetInternal=0,this.lineNumberInternal=0,this.columnNumberInternal=0}advance(t){for(this.offsetInternal=t;this.lineNumberInternal<this.lineEndings.length&&this.lineEndings[this.lineNumberInternal]<this.offsetInternal;)++this.lineNumberInternal;this.columnNumberInternal=this.lineNumberInternal?this.offsetInternal-this.lineEndings[this.lineNumberInternal-1]-1:this.offsetInternal}offset(){return this.offsetInternal}resetTo(t){this.offsetInternal=t,this.lineNumberInternal=e.ArrayUtilities.lowerBound(this.lineEndings,t,e.ArrayUtilities.DEFAULT_COMPARATOR),this.columnNumberInternal=this.lineNumberInternal?this.offsetInternal-this.lineEndings[this.lineNumberInternal-1]-1:this.offsetInternal}lineNumber(){return this.lineNumberInternal}columnNumber(){return this.columnNumberInternal}}var o=Object.freeze({__proto__:null,TextCursor:s});class l{startLine;startColumn;endLine;endColumn;constructor(t,e,n,r){this.startLine=t,this.startColumn=e,this.endLine=n,this.endColumn=r}static createFromLocation(t,e){return new l(t,e,t,e)}static createUnboundedFromLocation(t,e){return new l(t,e,2147483647,2147483647)}static fromObject(t){return new l(t.startLine,t.startColumn,t.endLine,t.endColumn)}static comparator(t,e){return t.compareTo(e)}static fromEdit(t,n){let r=t.startLine,i=t.startColumn+n.length;const s=e.StringUtilities.findLineEndingIndexes(n);if(s.length>1){r=t.startLine+s.length-1;const e=s.length;i=s[e-1]-s[e-2]-1}return new l(t.startLine,t.startColumn,r,i)}isEmpty(){return this.startLine===this.endLine&&this.startColumn===this.endColumn}immediatelyPrecedes(t){return!!t&&(this.endLine===t.startLine&&this.endColumn===t.startColumn)}immediatelyFollows(t){return!!t&&t.immediatelyPrecedes(this)}follows(t){return t.endLine===this.startLine&&t.endColumn<=this.startColumn||t.endLine<this.startLine}get linesCount(){return this.endLine-this.startLine}collapseToEnd(){return new l(this.endLine,this.endColumn,this.endLine,this.endColumn)}collapseToStart(){return new l(this.startLine,this.startColumn,this.startLine,this.startColumn)}normalize(){return this.startLine>this.endLine||this.startLine===this.endLine&&this.startColumn>this.endColumn?new l(this.endLine,this.endColumn,this.startLine,this.startColumn):this.clone()}clone(){return new l(this.startLine,this.startColumn,this.endLine,this.endColumn)}serializeToObject(){return{startLine:this.startLine,startColumn:this.startColumn,endLine:this.endLine,endColumn:this.endColumn}}compareTo(t){return this.startLine>t.startLine?1:this.startLine<t.startLine?-1:this.startColumn>t.startColumn?1:this.startColumn<t.startColumn?-1:0}compareToPosition(t,e){return t<this.startLine||t===this.startLine&&e<this.startColumn?-1:t>this.endLine||t===this.endLine&&e>this.endColumn?1:0}equal(t){return this.startLine===t.startLine&&this.endLine===t.endLine&&this.startColumn===t.startColumn&&this.endColumn===t.endColumn}relativeTo(t,e){const n=this.clone();return this.startLine===t&&(n.startColumn-=e),this.endLine===t&&(n.endColumn-=e),n.startLine-=t,n.endLine-=t,n}relativeFrom(t,e){const n=this.clone();return 0===this.startLine&&(n.startColumn+=e),0===this.endLine&&(n.endColumn+=e),n.startLine+=t,n.endLine+=t,n}rebaseAfterTextEdit(t,e){console.assert(t.startLine===e.startLine),console.assert(t.startColumn===e.startColumn);const n=this.clone();if(!this.follows(t))return n;const r=e.endLine-t.endLine,i=e.endColumn-t.endColumn;return n.startLine+=r,n.endLine+=r,n.startLine===e.endLine&&(n.startColumn+=i),n.endLine===e.endLine&&(n.endColumn+=i),n}toString(){return JSON.stringify(this)}containsLocation(t,e){return this.startLine===this.endLine?this.startLine===t&&this.startColumn<=e&&e<=this.endColumn:this.startLine===t?this.startColumn<=e:this.endLine===t?e<=this.endColumn:this.startLine<t&&t<this.endLine}get start(){return{lineNumber:this.startLine,columnNumber:this.startColumn}}get end(){return{lineNumber:this.endLine,columnNumber:this.endColumn}}}class a{offset;length;constructor(t,e){this.offset=t,this.length=e}}var u=Object.freeze({__proto__:null,TextRange:l,SourceRange:a});class h{valueInternal;lineEndingsInternal;constructor(t){this.valueInternal=t}lineEndings(){return this.lineEndingsInternal||(this.lineEndingsInternal=e.StringUtilities.findLineEndingIndexes(this.valueInternal)),this.lineEndingsInternal}value(){return this.valueInternal}lineCount(){return this.lineEndings().length}offsetFromPosition(t,e){return(t?this.lineEndings()[t-1]+1:0)+e}positionFromOffset(t){const n=this.lineEndings(),r=e.ArrayUtilities.lowerBound(n,t,e.ArrayUtilities.DEFAULT_COMPARATOR);return{lineNumber:r,columnNumber:t-(r&&n[r-1]+1)}}lineAt(t){const e=this.lineEndings(),n=t>0?e[t-1]+1:0,r=e[t];let i=this.valueInternal.substring(n,r);return i.length>0&&"\r"===i.charAt(i.length-1)&&(i=i.substring(0,i.length-1)),i}toSourceRange(t){const e=this.offsetFromPosition(t.startLine,t.startColumn),n=this.offsetFromPosition(t.endLine,t.endColumn);return new a(e,n-e)}toTextRange(t){const e=new s(this.lineEndings()),n=l.createFromLocation(0,0);return e.resetTo(t.offset),n.startLine=e.lineNumber(),n.startColumn=e.columnNumber(),e.advance(t.offset+t.length),n.endLine=e.lineNumber(),n.endColumn=e.columnNumber(),n}replaceRange(t,e){const n=this.toSourceRange(t);return this.valueInternal.substring(0,n.offset)+e+this.valueInternal.substring(n.offset+n.length)}extract(t){const e=this.toSourceRange(t);return this.valueInternal.substr(e.offset,e.length)}}var c=Object.freeze({__proto__:null,Text:h});const d={get _keyValueFilterRegex(){return/(?:^|\s)(\-)?([\w\-]+):([^\s]+)/},get _regexFilterRegex(){return/(?:^|\s)(\-)?\/([^\s]+)\//},get _textFilterRegex(){return/(?:^|\s)(\-)?([^\s]+)/},get _SpaceCharRegex(){return/\s/},get Indent(){return{TwoSpaces:"  ",FourSpaces:"    ",EightSpaces:"        ",TabCharacter:"\t"}},isStopChar:function(t){return t>" "&&t<"0"||t>"9"&&t<"A"||t>"Z"&&t<"_"||t>"_"&&t<"a"||t>"z"&&t<="~"},isWordChar:function(t){return!d.isStopChar(t)&&!d.isSpaceChar(t)},isSpaceChar:function(t){return d._SpaceCharRegex.test(t)},isWord:function(t){for(let e=0;e<t.length;++e)if(!d.isWordChar(t.charAt(e)))return!1;return!0},isOpeningBraceChar:function(t){return"("===t||"{"===t},isClosingBraceChar:function(t){return")"===t||"}"===t},isBraceChar:function(t){return d.isOpeningBraceChar(t)||d.isClosingBraceChar(t)},textToWords:function(t,e,n){let r=-1;for(let i=0;i<t.length;++i)e(t.charAt(i))?-1===r&&(r=i):(-1!==r&&n(t.substring(r,i)),r=-1);-1!==r&&n(t.substring(r))},lineIndent:function(t){let e=0;for(;e<t.length&&d.isSpaceChar(t.charAt(e));)++e;return t.substr(0,e)},isUpperCase:function(t){return t===t.toUpperCase()},isLowerCase:function(t){return t===t.toLowerCase()},splitStringByRegexes(t,e){const n=[],r=[];for(let t=0;t<e.length;t++){const n=e[t];n.global?r.push(n):r.push(new RegExp(n.source,n.flags?n.flags+"g":"g"))}return function t(e,i,s){if(i>=r.length)return void n.push({value:e,position:s,regexIndex:-1,captureGroups:[]});const o=r[i];let l,a=0;o.lastIndex=0;for(;null!==(l=o.exec(e));){const r=e.substring(a,l.index);r&&t(r,i+1,s+a);const o=l[0];n.push({value:o,position:s+l.index,regexIndex:i,captureGroups:l.slice(1)}),a=l.index+o.length}const u=e.substring(a);u&&t(u,i+1,s+a)}(t,0,0),n}};const m=function(t,n,i,s){const o=e.StringUtilities.createSearchRegex(n,i,s),l=new h(t),a=[];for(let t=0;t<l.lineCount();++t){const e=l.lineAt(t);o.lastIndex=0;const n=o.exec(e);n&&a.push(new r(t,e,n.index))}return a};var f=Object.freeze({__proto__:null,Utils:d,FilterParser:class{keys;constructor(t){this.keys=t}static cloneFilter(t){return{key:t.key,text:t.text,regex:t.regex,negative:t.negative}}parse(t){const e=d.splitStringByRegexes(t,[d._keyValueFilterRegex,d._regexFilterRegex,d._textFilterRegex]),n=[];for(const{regexIndex:t,captureGroups:r}of e)if(-1!==t)if(0===t){const t=r[0],e=r[1],i=r[2];-1!==this.keys.indexOf(e)?n.push({key:e,regex:void 0,text:i,negative:Boolean(t)}):n.push({key:void 0,regex:void 0,text:`${e}:${i}`,negative:Boolean(t)})}else if(1===t){const t=r[0],e=r[1];try{n.push({key:void 0,regex:new RegExp(e,"i"),text:void 0,negative:Boolean(t)})}catch(r){n.push({key:void 0,regex:void 0,text:`/${e}/`,negative:Boolean(t)})}}else if(2===t){const t=r[0],e=r[1];n.push({key:void 0,regex:void 0,text:e,negative:Boolean(t)})}return n}},BalancedJSONTokenizer:class{callback;index;balance;buffer;findMultiple;closingDoubleQuoteRegex;lastBalancedIndex;constructor(t,e){this.callback=t,this.index=0,this.balance=0,this.buffer="",this.findMultiple=e||!1,this.closingDoubleQuoteRegex=/[^\\](?:\\\\)*"/g}write(t){this.buffer+=t;const e=this.buffer.length,n=this.buffer;let r;for(r=this.index;r<e;++r){const t=n[r];if('"'===t){if(this.closingDoubleQuoteRegex.lastIndex=r,!this.closingDoubleQuoteRegex.test(n))break;r=this.closingDoubleQuoteRegex.lastIndex-1}else if("{"===t)++this.balance;else if("}"===t){if(--this.balance,this.balance<0)return this.reportBalanced(),!1;if(!this.balance&&(this.lastBalancedIndex=r+1,!this.findMultiple))break}else if("]"===t&&!this.balance)return this.reportBalanced(),!1}return this.index=r,this.reportBalanced(),!0}reportBalanced(){this.lastBalancedIndex&&(this.callback(this.buffer.slice(0,this.lastBalancedIndex)),this.buffer=this.buffer.slice(this.lastBalancedIndex),this.index-=this.lastBalancedIndex,this.lastBalancedIndex=0)}remainder(){return this.buffer}},isMinified:function(t){let e=0;for(let n=0;n<t.length;++e){let e=t.indexOf("\n",n);e<0&&(e=t.length),n=e+1}return(t.length-e)/e>=80},performSearchInContent:m});class g{contentURLInternal;contentTypeInternal;lazyContent;constructor(t,e,n){this.contentURLInternal=t,this.contentTypeInternal=e,this.lazyContent=n}static fromString(t,e,n){return new g(t,e,(()=>Promise.resolve({content:n,isEncoded:!1})))}contentURL(){return this.contentURLInternal}contentType(){return this.contentTypeInternal}requestContent(){return this.lazyContent()}async searchInContent(t,e,n){const{content:r}=await this.lazyContent();return r?m(r,t,e,n):[]}}var C=Object.freeze({__proto__:null,StaticContentProvider:g});export{n as CodeMirrorUtils,i as ContentProvider,C as StaticContentProvider,c as Text,o as TextCursor,u as TextRange,f as TextUtils};
