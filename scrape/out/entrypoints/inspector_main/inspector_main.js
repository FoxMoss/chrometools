import*as e from"../../core/common/common.js";import*as t from"../../core/i18n/i18n.js";import*as a from"../../ui/legacy/legacy.js";import*as n from"../../core/host/host.js";import*as s from"../../core/root/root.js";import*as o from"../../core/sdk/sdk.js";import*as i from"../../panels/mobile_throttling/mobile_throttling.js";import*as r from"../../ui/legacy/components/utils/utils.js";const c=new CSSStyleSheet;c.replaceSync(':host{padding:12px}[is="dt-checkbox"]{margin:0 0 10px;flex:none}.panel-section-separator{height:1px;margin-bottom:10px;background:var(--color-details-hairline);flex:none}.panel-section-separator:last-child{background:transparent}.chrome-select-label{margin-bottom:16px}\n/*# sourceURL=renderingOptions.css */\n');const l={paintFlashing:"Paint flashing",highlightsAreasOfThePageGreen:"Highlights areas of the page (green) that need to be repainted. May not be suitable for people prone to photosensitive epilepsy.",layoutShiftRegions:"Layout Shift Regions",highlightsAreasOfThePageBlueThat:"Highlights areas of the page (blue) that were shifted. May not be suitable for people prone to photosensitive epilepsy.",layerBorders:"Layer borders",showsLayerBordersOrangeoliveAnd:"Shows layer borders (orange/olive) and tiles (cyan).",frameRenderingStats:"Frame Rendering Stats",plotsFrameThroughputDropped:"Plots frame throughput, dropped frames distribution, and GPU memory.",scrollingPerformanceIssues:"Scrolling performance issues",highlightsElementsTealThatCan:"Highlights elements (teal) that can slow down scrolling, including touch & wheel event handlers and other main-thread scrolling situations.",highlightAdFrames:"Highlight ad frames",highlightsFramesRedDetectedToBe:"Highlights frames (red) detected to be ads.",coreWebVitals:"Core Web Vitals",showsAnOverlayWithCoreWebVitals:"Shows an overlay with Core Web Vitals.",disableLocalFonts:"Disable local fonts",disablesLocalSourcesInFontface:"Disables `local()` sources in `@font-face` rules. Requires a page reload to apply.",emulateAFocusedPage:"Emulate a focused page",emulatesAFocusedPage:"Emulates a focused page.",emulateAutoDarkMode:"Enable automatic dark mode",emulatesAutoDarkMode:"Enables automatic dark mode and sets `prefers-color-scheme` to `dark`.",forcesMediaTypeForTestingPrint:"Forces media type for testing print and screen styles",forcesCssPreferscolorschemeMedia:"Forces CSS `prefers-color-scheme` media feature",forcesCssPrefersreducedmotion:"Forces CSS `prefers-reduced-motion` media feature",forcesCssPreferscontrastMedia:"Forces CSS `prefers-contrast` media feature",forcesCssPrefersreduceddataMedia:"Forces CSS `prefers-reduced-data` media feature",forcesCssColorgamutMediaFeature:"Forces CSS `color-gamut` media feature",forcesVisionDeficiencyEmulation:"Forces vision deficiency emulation",disableAvifImageFormat:"Disable `AVIF` image format",requiresAPageReloadToApplyAnd:"Requires a page reload to apply and disables caching for image requests.",disableWebpImageFormat:"Disable `WebP` image format",forcesCssForcedColors:"Forces CSS forced-colors media feature"},d=t.i18n.registerUIStrings("entrypoints/inspector_main/RenderingOptions.ts",l),g=t.i18n.getLocalizedString.bind(void 0,d);let u,h;class p extends a.Widget.VBox{constructor(){super(!0),this.#e(g(l.paintFlashing),g(l.highlightsAreasOfThePageGreen),e.Settings.Settings.instance().moduleSetting("showPaintRects")),this.#e(g(l.layoutShiftRegions),g(l.highlightsAreasOfThePageBlueThat),e.Settings.Settings.instance().moduleSetting("showLayoutShiftRegions")),this.#e(g(l.layerBorders),g(l.showsLayerBordersOrangeoliveAnd),e.Settings.Settings.instance().moduleSetting("showDebugBorders")),this.#e(g(l.frameRenderingStats),g(l.plotsFrameThroughputDropped),e.Settings.Settings.instance().moduleSetting("showFPSCounter")),this.#e(g(l.scrollingPerformanceIssues),g(l.highlightsElementsTealThatCan),e.Settings.Settings.instance().moduleSetting("showScrollBottleneckRects")),this.#e(g(l.highlightAdFrames),g(l.highlightsFramesRedDetectedToBe),e.Settings.Settings.instance().moduleSetting("showAdHighlights")),this.#e(g(l.coreWebVitals),g(l.showsAnOverlayWithCoreWebVitals),e.Settings.Settings.instance().moduleSetting("showWebVitals")),this.#e(g(l.disableLocalFonts),g(l.disablesLocalSourcesInFontface),e.Settings.Settings.instance().moduleSetting("localFontsDisabled")),this.#e(g(l.emulateAFocusedPage),g(l.emulatesAFocusedPage),e.Settings.Settings.instance().moduleSetting("emulatePageFocus")),this.#e(g(l.emulateAutoDarkMode),g(l.emulatesAutoDarkMode),e.Settings.Settings.instance().moduleSetting("emulateAutoDarkMode")),this.contentElement.createChild("div").classList.add("panel-section-separator"),this.#t(g(l.forcesCssPreferscolorschemeMedia),e.Settings.Settings.instance().moduleSetting("emulatedCSSMediaFeaturePrefersColorScheme")),this.#t(g(l.forcesMediaTypeForTestingPrint),e.Settings.Settings.instance().moduleSetting("emulatedCSSMedia")),this.#t(g(l.forcesCssForcedColors),e.Settings.Settings.instance().moduleSetting("emulatedCSSMediaFeatureForcedColors")),(()=>{const e="(prefers-contrast)";return window.matchMedia(e).media===e})()&&this.#t(g(l.forcesCssPreferscontrastMedia),e.Settings.Settings.instance().moduleSetting("emulatedCSSMediaFeaturePrefersContrast")),this.#t(g(l.forcesCssPrefersreducedmotion),e.Settings.Settings.instance().moduleSetting("emulatedCSSMediaFeaturePrefersReducedMotion")),(()=>{const e="(prefers-reduced-data)";return window.matchMedia(e).media===e})()&&this.#t(g(l.forcesCssPrefersreduceddataMedia),e.Settings.Settings.instance().moduleSetting("emulatedCSSMediaFeaturePrefersReducedData")),this.#t(g(l.forcesCssColorgamutMediaFeature),e.Settings.Settings.instance().moduleSetting("emulatedCSSMediaFeatureColorGamut")),this.contentElement.createChild("div").classList.add("panel-section-separator"),this.#t(g(l.forcesVisionDeficiencyEmulation),e.Settings.Settings.instance().moduleSetting("emulatedVisionDeficiency")),this.contentElement.createChild("div").classList.add("panel-section-separator"),this.#e(g(l.disableAvifImageFormat),g(l.requiresAPageReloadToApplyAnd),e.Settings.Settings.instance().moduleSetting("avifFormatDisabled")),this.#e(g(l.disableWebpImageFormat),g(l.requiresAPageReloadToApplyAnd),e.Settings.Settings.instance().moduleSetting("webpFormatDisabled")),this.contentElement.createChild("div").classList.add("panel-section-separator")}static instance(e={forceNew:null}){const{forceNew:t}=e;return u&&!t||(u=new p),u}#a(e,t,n){const s=a.UIUtils.CheckboxLabel.create(e,!1,t);return a.SettingsUI.bindCheckbox(s.checkboxElement,n),s}#e(e,t,a){const n=this.#a(e,t,a);return this.contentElement.appendChild(n),n}#t(e,t){const n=a.SettingsUI.createControlForSetting(t,e);n&&this.contentElement.appendChild(n)}wasShown(){super.wasShown(),this.registerCSSFiles([c])}}class m{static instance(e={forceNew:null}){const{forceNew:t}=e;return h&&!t||(h=new m),h}handleAction(t,a){const n=e.Settings.Settings.instance().moduleSetting("emulatedCSSMediaFeaturePrefersColorScheme");if("rendering.toggle-prefers-color-scheme"===a){const e=["","light","dark"],t=e.findIndex((e=>e===n.get()||""));return n.set(e[(t+1)%3]),!0}return!1}}var S=Object.freeze({__proto__:null,RenderingOptionsView:p,ReloadActionDelegate:m});const f=new CSSStyleSheet;f.replaceSync(".node-icon{width:28px;height:26px;background-image:var(--image-file-nodeIcon);background-size:17px 17px;background-repeat:no-repeat;background-position:center;opacity:80%;cursor:auto}.node-icon:hover{opacity:100%}.node-icon.inactive{filter:grayscale(100%)}\n/*# sourceURL=nodeIcon.css */\n");const b={main:"Main",tab:"Tab",javascriptIsDisabled:"JavaScript is disabled",openDedicatedTools:"Open dedicated DevTools for `Node.js`"},T=t.i18n.registerUIStrings("entrypoints/inspector_main/InspectorMain.ts",b),C=t.i18n.getLocalizedString.bind(void 0,T);let F,y,w,A;class M{static instance(e={forceNew:null}){const{forceNew:t}=e;return F&&!t||(F=new M),F}async run(){let e=!0;await o.Connections.initMainConnection((async()=>{const t=s.Runtime.Runtime.queryParam("v8only")?o.Target.Type.Node:"tab"===s.Runtime.Runtime.queryParam("targetType")?o.Target.Type.Tab:o.Target.Type.Frame,a=t===o.Target.Type.Frame&&"sources"===s.Runtime.Runtime.queryParam("panel"),n=t===o.Target.Type.Frame?C(b.main):C(b.tab),i=o.TargetManager.TargetManager.instance().createTarget("main",n,t,null,void 0,a),r=o.TargetManager.TargetManager.instance();if(r.observeTargets({targetAdded:e=>{e===r.mainFrameTarget()&&e.setName(C(b.main))},targetRemoved:e=>{}}),e){if(e=!1,a){const e=i.model(o.DebuggerModel.DebuggerModel);e&&(e.isReadyToPause()||await e.once(o.DebuggerModel.Events.DebuggerIsReadyToPause),e.pause())}t!==o.Target.Type.Tab&&i.runtimeAgent().invoke_runIfWaitingForDebugger()}}),r.TargetDetachedDialog.TargetDetachedDialog.webSocketConnectionLost),new I,new R,new i.NetworkPanelIndicator.NetworkPanelIndicator,n.InspectorFrontendHost.InspectorFrontendHostInstance.events.addEventListener(n.InspectorFrontendHostAPI.Events.ReloadInspectedPage,(({data:e})=>{o.ResourceTreeModel.ResourceTreeModel.reloadAllPages(e)}))}}e.Runnable.registerEarlyInitializationRunnable(M.instance);class P{static instance(e={forceNew:null}){const{forceNew:t}=e;return y&&!t||(y=new P),y}handleAction(e,t){switch(t){case"inspector_main.reload":return o.ResourceTreeModel.ResourceTreeModel.reloadAllPages(!1),!0;case"inspector_main.hard-reload":return o.ResourceTreeModel.ResourceTreeModel.reloadAllPages(!0),!0}return!1}}class k{static instance(e={forceNew:null}){const{forceNew:t}=e;return w&&!t||(w=new k),w}handleAction(e,t){const a=o.TargetManager.TargetManager.instance().mainFrameTarget();return!!a&&(a.pageAgent().invoke_bringToFront(),!0)}}class v{#n;#s;constructor(){const e=document.createElement("div"),t=a.Utils.createShadowRootWithCoreStyles(e,{cssFile:[f],delegatesFocus:void 0});this.#n=t.createChild("div","node-icon"),e.addEventListener("click",(()=>n.InspectorFrontendHost.InspectorFrontendHostInstance.openNodeFrontend()),!1),this.#s=new a.Toolbar.ToolbarItem(e),this.#s.setTitle(C(b.openDedicatedTools)),o.TargetManager.TargetManager.instance().addEventListener(o.TargetManager.Events.AvailableTargetsChanged,(e=>this.#o(e.data))),this.#s.setVisible(!1),this.#o([])}static instance(e={forceNew:null}){const{forceNew:t}=e;return A&&!t||(A=new v),A}#o(e){const t=Boolean(e.find((e=>"node"===e.type&&!e.attached)));this.#n.classList.toggle("inactive",!t),t&&this.#s.setVisible(!0)}item(){return this.#s}}class I{constructor(){function t(){let t=null;e.Settings.Settings.instance().moduleSetting("javaScriptDisabled").get()&&(t=a.Icon.Icon.create("smallicon-warning"),a.Tooltip.Tooltip.install(t,C(b.javascriptIsDisabled))),a.InspectorView.InspectorView.instance().setPanelIcon("sources",t)}e.Settings.Settings.instance().moduleSetting("javaScriptDisabled").addChangeListener(t),t()}}class R{#i;#r;#c;constructor(){this.#i=e.Settings.Settings.instance().moduleSetting("autoAttachToCreatedPages"),this.#i.addChangeListener(this.#l,this),this.#l(),this.#r=e.Settings.Settings.instance().moduleSetting("network.adBlockingEnabled"),this.#r.addChangeListener(this.#o,this),this.#c=e.Settings.Settings.instance().moduleSetting("emulatePageFocus"),this.#c.addChangeListener(this.#o,this),o.TargetManager.TargetManager.instance().observeTargets(this)}#d(e){e.type()===o.Target.Type.Frame&&e.parentTarget()?.type()!==o.Target.Type.Frame&&(e.pageAgent().invoke_setAdBlockingEnabled({enabled:this.#r.get()}),e.emulationAgent().invoke_setFocusEmulationEnabled({enabled:this.#c.get()}))}#l(){n.InspectorFrontendHost.InspectorFrontendHostInstance.setOpenNewWindowForPopups(this.#i.get())}#o(){for(const e of o.TargetManager.TargetManager.instance().targets())this.#d(e)}targetAdded(e){this.#d(e)}targetRemoved(e){}}o.ChildTargetManager.ChildTargetManager.install();var D=Object.freeze({__proto__:null,InspectorMainImpl:M,ReloadActionDelegate:P,FocusDebuggeeActionDelegate:k,NodeIndicator:v,SourcesPanelIndicator:I,BackendSettingsSync:R});export{D as InspectorMain,S as RenderingOptions};
